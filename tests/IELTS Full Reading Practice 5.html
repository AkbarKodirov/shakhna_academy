<!DOCTYPE html>
<!-- saved from url=(0068)file:///D:/downloads/Mock%20reading%20for%20Intensive%20Masters.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Full Reading Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            line-height: 1.4;
            font-size: 16px;
        }



        .header {
            background-color: #ffffff;
            padding: 12px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            height: 60px;
        }

        .ielts-logo {
            display: none;
        }

        .test-info {
            display: flex;
            align-items: center;
            gap: 30px;
            font-size: 14px;
            color: #333;
        }

        .audio-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }

        .audio-icon {
            width: 16px;
            height: 16px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon></svg>') no-repeat center;
        }

        .header-icons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .telegram-link {
            color: #0088cc;
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .telegram-link:hover {
            text-decoration: underline;
        }

        .telegram-link::before {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            background-color: currentColor;
            -webkit-mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-1.37.2-1.64l16.56-6.4c.75-.29 1.4.22 1.2.94l-2.67 12.61c-.22.95-1.13 1.18-1.78.73l-4.5-3.32l-2.23 2.15c-.47.44-1.29.21-1.48-.37z"/></svg>');
            mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-1.37.2-1.64l16.56-6.4c.75-.29 1.4.22 1.2.94l-2.67 12.61c-.22.95-1.13 1.18-1.78.73l-4.5-3.32l-2.23 2.15c-.47.44-1.29.21-1.48-.37z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
        }

        #volume-slider {
            -webkit-appearance: none;
            width: 80px;
            height: 4px;
            background: #ddd;
            outline: none;
            border-radius: 2px;
            cursor: pointer;
        }

        #volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
        }

        #volume-slider::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
            border: none;
        }

        .icon {
            width: 20px;
            height: 20px;
            cursor: pointer;
            opacity: 0.7;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .icon:hover {
            opacity: 1;
        }
        
        #play-pause-btn {
            background: none;
            border: none;
            padding: 0;
        }

        .main-container {
            margin-top: 60px;
            display: flex;
            flex-direction: column;
            background: #ffffff;
            height: calc(100vh - 60px); /* Full height minus header */
        }

        .panels-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .passage-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px; /* Minimum width */
        }

        /* Passage Content */
        .text-center {
            text-align: center;
        }
        .reading-passage h4 {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
       
        .reading-passage p {
            margin-bottom: 1.2em;
        }

        .question ul li label {
            display: block;
            margin-top: 8px;
            cursor: pointer;
        }

        .questions-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px; /* Minimum width */
            border-left: 1px solid #e0e0e0;
        }

        .resizer {
            width: 10px;
            cursor: col-resize;
            background-color: #f0f0f0;
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="10" height="30" viewBox="0 0 10 30"><path d="M4 11h2v2H4zM4 15h2v2H4zM4 19h2v2H4z" fill="%23888"/></svg>');
            background-repeat: no-repeat;
            background-position: center;
            flex-shrink: 0;
            flex-grow: 0;
        }

        /* Left Panel */
        .left-panel {
            width: 100%;
            padding: 20px;
        }

        /* Right Panel */
        .right-panel {
            display: none;
            width: 50%;
            padding: 20px;
            position: relative;
        }

        .help-button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 20px;
        }

        .help-button:hover {
            background: #357abd;
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .people-section {
            margin-bottom: 30px;
        }

        .people-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ccc;
        }

        .people-table th {
            text-align: left;
            padding: 10px;
            font-weight: bold;
            border: 1px solid #ddd;
        }

        .people-table td {
            padding: 8px 10px;
            border: 1px solid #ddd;
        }

        .person-name {
            font-size: 16px;
        }

        .question-number {
            background: white;
            border: 1px solid #4a90e2;
            padding: 4px 8px;
            border-radius: 3px;
            font-weight: bold;
            font-size: 14px;
            color: #4a90e2;
            min-width: 30px;
            text-align: center;
        }

        .assigned-responsibility {
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 14px;
            border: 1px solid #ddd;
        }

        .responsibilities-section {
            margin-bottom: 30px;
        }

        .responsibility-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .responsibility-item {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            text-align: center;
            transition: all 0.2s;
        }

        .responsibility-item:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .responsibility-item.dragging {
            opacity: 0.5;
        }

        .questions-section {
            margin-bottom: 20px;
        }

        .question-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .instruction {
            margin-bottom: 20px;
            font-size: 16px;
            color: #666;
        }

        /* Map Styles */
        .map-container {
            position: relative;
            margin: 20px 0;
            display: flex;
            justify-content: center;
        }

        .map-svg {
            border: 2px solid #333;
            background: white;
        }

        .map-room {
            fill: #f9f9f9;
            stroke: #333;
            stroke-width: 1;
        }

        .map-text {
            font-family: Arial, sans-serif;
            font-size: 13px;
            text-anchor: middle;
            fill: #333;
        }

        .map-number {
            font-family: Arial, sans-serif;
            font-size: 16px;
            font-weight: bold;
            text-anchor: middle;
            fill: #333;
        }

        .room-labels {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .room-label {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            text-align: center;
            transition: all 0.2s;
        }

        .room-label:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .room-label.dragging {
            opacity: 0.5;
        }

        /* Navigation Arrows */
        .nav-arrows {
            position: fixed;
            bottom: 100px;
            right: 20px;
            display: flex;
            gap: 5px;
            z-index: 101;
        }

        .nav-arrow {
            width: 50px;
            height: 50px;
            background: #333;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: bold;
        }

        .nav-arrow:hover {
            background: #555;
        }

        .nav-arrow:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* Bottom Navigation - Exact Match */
        .nav-row {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;
        
            padding: 0;
            display: flex;
            align-items: center;
            height: 80px;
            z-index: 100;
        }

        .footer__questionWrapper___1tZ46 {
            display: flex;
            align-items: center;
            margin-right: 20px;
        }


        .footer__questionNo___3WNct {
            background: none;
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.2s;
        }

        .footer__questionNo___3WNct:hover {
            background-color: #f8f9fa;
        }

        .section-prefix {
            font-size: 16px;
        }

        .sectionNr {
            font-size: 16px;
            font-weight: bold;
        }

        .attemptedCount {
            font-size: 14px;
            color: #666;
            margin-left: 5px;
            font-weight: 400; /* Normal weight */
        }

        @media (max-width: 768px) {
            .attemptedCount {
                display: none;
            }
        }

        .footer__questionWrapper___1tZ46.selected .attemptedCount {
            display: none;
        }

        .footer__subquestionWrapper___9GgoP {
            display: none;
            gap: 2px;
            margin-left: 10px;
        }

        .footer__questionWrapper___1tZ46.selected .footer__subquestionWrapper___9GgoP {
            display: flex;
        }

        .subQuestion {
            width: 32px;
            height: 32px;
            border: 1px solid #ccc;
            background: white;
            color: #333;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            border-radius: 2px;
        }

        .subQuestion.answered {
            background-color: #e9ecef;
            border-color: #ddd;
        }
        .subQuestion.correct {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }
        .subQuestion.incorrect {
            background-color: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .subQuestion:hover {
            background-color: #f0f0f0;
            border-color: #999;
        }

        .subQuestion.active {
            background-color: #4a90e2;
            color: white;
            border-color: #4a90e2;
        }

        .subQuestion.completed {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .footer__deliverButton___3FM07 {
            margin-left: auto;
            margin-right: 20px;
            background-color: #f0f0f0;
            color: #333;
            border: 1px solid #ccc;
            padding: 12px 20px;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s, border-color 0.2s;
            min-width: 170px;
            justify-content: center;
        }

        .footer__deliverButton___3FM07:hover {
            background-color: #e0e0e0;
            border-color: #bbb;
        }

        .footer__deliverButton___3FM07:disabled {
            background: #e9ecef;
            color: #6c757d;
            cursor: not-allowed;
            border-color: #ddd;
        }

        .fa-check::before {
            content: "✓";
        }

        .hidden {
            display: none !important;
        }

        /* Context Menu */
        .context-menu {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
            min-width: 140px;
        }

        .context-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-menu-item:hover {
            background-color: #f8f9fa;
        }

        .context-menu-item:last-child {
            border-bottom: none;
        }

        .highlight {
            background-color: #ffff00;
        }

        .comment-highlight {
            background-color: #90EE90;
            position: relative;
            cursor: help;
        }

        .comment-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            white-space: nowrap;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .comment-highlight:hover .comment-tooltip {
            opacity: 1;
        }

        .question {
            margin-bottom: 40px;
        }
        .question p {
            margin-bottom: 10px;
        }
        .question ul, .question .people-table {
            margin-top: 0;
        }
        .question-prompt {
            margin-bottom: 20px;
        }
        .question ul {
            list-style: none;
            padding-left: 0;
        }
        .question ul li {
            margin-bottom: 5px;
        }
        .answer-input {
            border: 1px solid #888;
            border-radius: 4px;
            background-color: #fff;
            padding: 2px 5px;
            font-size: 16px;
            text-align: center;
            margin-right: 4px;
            margin-left: 4px;
            transition: border-color 0.3s, box-shadow 0.3s;
            height: 28px; /* Standard height */
            width: 150px; /* Standard width */
        }
        .answer-input.active-input {
            border-color: #4a90e2;
            box-shadow: 0 0 3px 1px rgba(74, 144, 226, 0.5);
        }
        .answer-input::placeholder {
            color: #999;
            font-weight: bold;
            text-align: center;
        }
        .answer-input.correct {
            border-color: #28a745;
            background-color: #e9f7ef;
        }
        .answer-input.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }
        .answer-input {
    z-index: 10;
    position: relative;
    pointer-events: auto;
}
        .drag-drop-container {
            display: flex;
            gap: 30px;
            margin-top: 20px;
            align-items: flex-start;
        }
        .recommendations-box {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
            min-height: 200px;
        }
        .drag-item {
            background: white;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            transition: all 0.2s;
            user-select: none;
        }
        .drag-item:hover {
            background: #e9ecef;
        }
        .drag-item.dragging {
            opacity: 0.5;
        }
        .drag-item.selected {
            border-color: #4a90e2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.5);
        }
        .drop-zone {
            border: 2px dashed #aaa;
            border-radius: 4px;
            width: 50%;
            margin-top: 19px;
            margin-bottom: 5px;
            transition: background-color 0.2s, border-color 0.2s;
            padding: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .drop-zone.drag-over {
            background-color: #e6f4ff;
            border-color: #4a90e2;
        }
        .drop-zone.correct {
            background-color: #e9f7ef;
            border-color: #28a745;
            border-style: solid;
        }
        .drop-zone.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
            border-style: solid;
        }
        .drop-zone.disabled {
            pointer-events: none;
        }
        .drop-zone .drag-item {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            padding: 2px;
        }
        .drag-options-container {
            margin-top: 10px;
        }
        .drag-options-container .drag-item {
            display: block;
            width: fit-content;
            font-size: 15px;
            padding: 0.5px 10px;
            margin-bottom: 5px;
        }
        .drag-options-container .drag-item:last-child {
            margin-bottom: 0;
        }
        .q-number {
            color: #888;
            font-size: 14px;
            font-weight: bold;
        }
        .questions-container {
            width: 100%;
        }
        audio {
            width: 100%;
            margin-bottom: 20px;
        }
        .part-header {
            background-color: #f1f2ec;
            padding: 15px 20px;
            border: 1px solid #e0e0e0;
            text-align: left;
            margin: 10px 20px;
            border-radius: 5px;
        }
        .part-header p {
            margin: 0;
        }
        .part-header p:first-child {
            margin-bottom: 5px;
        }

        .question li.correct {
            color: #155724;
            font-weight: bold;
        }
        .question li.incorrect {
            color: #721c24;
        }
        .question li.correct::before {
            content: '✔ ';
            color: #28a745;
        }
        .question li.incorrect::before {
            content: '✖ ';
            color: #dc3545;
        }

        .example-box {
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .timer-container {
            display: flex;
            position: relative;
            cursor: default;
            color: #333;
            font-size: 16px;
            font-weight: 500;
            align-items: center;
        }
        .timer-container .timer-tooltip {
            display: none;
        }

        .timer-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 15px;
        }

        .timer-controls button {
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 50%;
            padding: 0;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        .timer-controls button:hover {
            background: #e0e0e0;
        }

        .timer-controls button svg {
            width: 20px;
            height: 20px;
            fill: #333;
        }

        .audio-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(40, 40, 40, 0.9);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }
        .audio-modal-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            max-width: 500px;
            padding: 20px;
        }
        .audio-modal-content p {
            font-size: 16px;
            line-height: 1.5;
            color: #eee;
        }
        .audio-modal-icon {
            margin-bottom: 20px;
        }
        .modal-play-btn {
            background-color: #000;
            color: white;
            border: 1px solid white;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }
        .modal-play-btn:hover {
            background-color: #333;
        }
        #goto-widget {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        #goto-input {
            width: 80px;
            padding: 4px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #goto-btn {
            padding: 4px 10px;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Styles for TRUE/FALSE/NOT GIVEN questions */
        .tf-question {
            margin-bottom: 25px;
            padding: 10px 0px;
            border-radius: 4px;
            transition: border-color 0.3s, background-color 0.3s;
        }
        .tf-question-line {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 5px 0px;
            border-radius: 4px;
        }
        .tf-question-number, .question-number-box {
            border: 2px solid #ccc;
            padding: 2px 8px;
            margin-right: 10px;
            border-radius: 3px;
            font-weight: bold;
            transition: border-color 0.3s;
            display: inline-block;
        }
        .tf-question-text {
            padding-top: 3px;
        }
        .tf-options {
            padding-left: 5px;
        }
        .tf-option {
            display: block;
            margin-bottom: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        .tf-option input[type="radio"] {
            margin-right: 10px;
            transform: scale(1.2);
        }
        .tf-question.correct .tf-question-line {
            background-color: #e9f7ef;
        }
        .tf-question.incorrect .tf-question-line {
            background-color: #f8d7da;
        }
        .matching-question-container {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        .matching-options-bank {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .matching-questions {
            flex: 1.5;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .matching-question-item {
            display: flex;
            align-items: center;
            gap: 15px;

            border: 2px solid transparent;
            border-radius: 4px;
            transition: border-color 0.3s;
        }
        .matching-question-item > span {
            flex: 1;
        }
        .matching-question-item.correct {
            background-color: #e9f7ef;
            border-color: #28a745 !important;
        }
        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }
        .matching-question-item .drop-zone {
            width: 200px;
            flex-shrink: 0;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #aaa;
        }
        .matching-options-bank .drag-item {
            font-size: 15px;
            text-align: center;
            border: 1px solid #ccc;
            background: #f9f9f9;
        }

        .questions-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px; /* Minimum width */
            border-left: 1px solid #e0e0e0;
        }
        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }
        .summary-completion-container {
            margin-top: 20px;
        }
        .summary-text p {
            line-height: 2.5;
            font-size: 16px;
        }
        .summary-drop-zone {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            vertical-align: middle;
            max-width:200px;
            height: 25px;
            border: 2px dashed #999;
            border-radius: 4px;
            margin: 0 5px;
            padding: 0 5px;
            transition: border-color 0.3s, box-shadow 0.3s, background-color 0.3s;
            color: #aaa;
            font-weight: bold;
        }
        .summary-drop-zone.filled {
            border-color: #4a90e2;
        }
        .summary-drop-zone.active-input {
             border-color: #4a90e2;
             box-shadow: none;
        }
        .summary-drop-zone .drag-item {
            font-size: 15px;
            font-weight: bold;
            background-color: transparent;
            border: none;
            padding: 0;
            text-align: center;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .summary-options-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .summary-options-bank .drag-item {
            flex-grow: 1;
            min-width: 100px;
            text-align: center;
        }
        .multi-choice-question {
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 4px;
            border: 3px solid transparent;
            transition: border-color 0.3s, background-color 0.3s;
        }
        .multi-choice-option {
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .multi-choice-option label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 16px;
        }
        .multi-choice-option input[type="checkbox"],
        .multi-choice-option input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.3);
            accent-color: #4a90e2;
        }
        .multi-choice-option.correct {
            background-color: #e9f7ef;
        }
        .multi-choice-option.incorrect {
            background-color: #f8d7da;
        }
        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }
        .matching-question-item .drop-zone.filled {
            border-color: #4a90e2;
        }
        .matching-question-item .drop-zone {
            width: 200px;
            height: 40px;
        }
        .paragraph-matching-question {
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 12px;
        }
        .paragraph-matching-question .answer-input {
            width: 80px;
            flex-shrink: 0;
        }

        .matching-form-container {
            margin-top: 20px;
        }
        .matching-form-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        .matching-form-label {
            width: 180px;
            flex-shrink: 0;
        }

        /* Results Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-overlay.hidden {
            display: none;
        }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #888;
        }
        .modal-content h2 {
            text-align: center;
            margin-bottom: 15px;
            color: #333;
        }
        .results-summary {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        .results-details-container {
            overflow-y: auto;
            padding-right: 10px; /* For scrollbar */
        }
        .result-row {
            display: grid;
            grid-template-columns: 40px 1fr 1fr;
            gap: 15px;
            padding: 8px 5px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 15px;
        }
        .result-row.incorrect {
            background-color: #f8d7da;
        }
        .result-row .q-num {
            font-weight: bold;
        }
        .result-row .user-ans {
            color: #555;
        }
        .result-row .correct-ans {
            color: #155724;
            font-weight: 500;
        }
        .correct-answer-display {
            font-weight: bold;
            color: #28a745;
            margin-left: 10px;
            font-size: 14px;
        }
        .correct-answer-highlight, .tf-option.correct-answer-highlight, .multi-choice-option.correct-answer-highlight {
            background-color: #d4edda !important;
            border: 1px solid #c3e6cb !important;
            border-radius: 4px;
            padding: 4px;
        }
        .correct-answer-highlight {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 4px;
        }
        .centered-title {
    text-align: center;
    font-size: 50px;
    font-weight: bold;
    margin-bottom: 15px;
}
    </style>
</head>
<body>
    <div class="header">
        <div style="margin-bottom: 15px;">
    <label for="studentName"><strong>Enter Your Name:</strong></label>
    <input type="text" id="studentName" placeholder="Your name here" style="padding: 5px; width: 250px;">
</div>
        <div class="timer-container">
            <span class="timer-display">61:50</span>
            <div class="timer-controls">
                <button id="timer-toggle-btn" title="Pause/Resume Timer"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg></button>
                <button id="timer-reset-btn" title="Reset Timer">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"></path></svg>
                </button>
            </div>
        </div>
        <a href="https://t.me/shakhnozanorova" target="_blank" class="telegram-link">
            Shakhna Academy
        </a>

        
    </div>

    <div class="main-container" id="main-container">
        <div id="passage-header-container">
            <div id="part-header-1" class="part-header">
                <p><strong>Part 1</strong></p>
                <p>Read the text and answer <strong>Questions 1-13.</strong></p>
            </div>
            <div id="part-header-2" class="part-header hidden">
                <p><strong>Part 2</strong></p>
                <p>Read the text and answer <strong>Questions 14-26.</strong></p>
            </div>
            <div id="part-header-3" class="part-header hidden">
                <p><strong>Part 3</strong></p>
                <p>Read the text and answer <strong>Questions 27-40.</strong></p>
            </div>
        </div>
        <div class="panels-container">
         <div class="passage-panel" id="passage-panel">
            <div id="passage-text-1" class="reading-passage">
  <h2 class="text-center">Native Species That Become Pests</h2>
  <p><em>The disastrous consequences of foxes, cane toads and other introduced animals coming to Australia are well known.</em></p>
  <p>But problems also occur when Australia's own native species spread from one region to another, moving beyond the areas where they have always lived. Mudsnails were first detected in the Swan River in Perth, Western Australia in 1954, and this was only in the river's lower areas. Since then their numbers have exploded and they now crowd the river bed in densities of up to 400 per square metre. This species is native to Australia but its natural range is more than 3000km away in eastern Australia. Due to the snail's success, the river beds in the Swan River, which were once covered in natural vegetation, are now under threat by increased levels of seaweed. Before the snail arrived, the river had few hard surfaces on which small seaweeds could grow. Now, healthy vegetation is being pulled up by snails and the riverbed is covered by seaweed that is carried in snail shells and is released at the rate of 433 million fragments a day. Furthermore, snail waste is thought to be aggravating the situation by having the effect of a fertiliser on the seaweed.</p>
  <p>Species are often moved unintentionally. Mudsnails are thought to have travelled on live oysters taken from eastern Australia to the west of the country and stored in the Swan River before use. Northern Queensland frogs regularly travel south inside bunches of bananas. Researchers estimate that more than 6000 of these reach the state of Victoria each year, although the only lasting impact observed so far is a colony of dwarf tree frogs that live in a flooded quarry near Melbourne, Victoria. Similarly, spiders relocate in construction supplies, while lizards move with firewood. It is not just animals that are relocated inadvertently; seeds from the centre of the country often reach the coast aboard cattle trains.</p>
  <p>Other animals have extended their ranges by themselves because changes to landscapes have suited them. Waterbirds arrive wherever dams are put in, bats find abandoned mines, and orchard swallowtail butterflies locate citrus trees that are planted near farm homes. Many of the birds now found in Australia's capital cities did not live in large cities in the past. Writing of the crested pigeon in 1865, naturalist John Gould regretted that "being exclusively an inhabitant of the plains of the interior, it can never become an object of general observation." Today, crested pigeons can be found in abundance in the middle of the coastal city of Sydney.</p>
  <p>Some species have been moved deliberately. The kookaburra is a famous Australian bird, which is found in many parts of the continent. Long ago these birds were taken well beyond the areas where they had always lived, for the purpose of exterminating snakes. Following concern that the platypus, an unusual Australian water mammal, was declining in number on the mainland, this species was introduced to a national park on an island off the south coast in the 1920s. Vast numbers of plants have also been cultivated in areas where they did not originally grow.</p>
  <p>There is no database of this movement and tracing species' existence and migration patterns can be difficult. For example, it is widely known that the venomous redback spider, common throughout Australia, lives close to humans in sheds and under outdoor furniture but is seldom seen in forests. Spider authority, Robert Raven, has wondered why this species went undiscovered until 1870, by which time 200 other Australian spiders had been named. Redbacks were hardly mentioned by early travellers and naturalists, and rarely feature in Aboriginal legends and languages. This led Raven to suspect that redbacks had been introduced to Australia from abroad. However, a mention of black-and-red spiders in South Australia was recently found in an 1850 book, and the thinking today is that redbacks are actually native to Australia's south-west, and were later introduced eastwards.</p>
  <p>Species on the move within Australia present an environmental challenge. Although many animals and plants are thought of as native to Australia, Australia is a continent and one of the world's largest countries. If it were divided, like Europe, into smaller countries, those snails and kookaburras in Perth would count as foreign. "Foreign" may not be the correct word, but the mud snails in Perth qualify as an introduced species and feral pest. The colourful rainbow lorikeets around Perth, descended from cage birds that managed to win their freedom, have been declared a state pest for the damage they do to stone fruits and other crops.</p>
  <p>Birds and bats that travel under their own wings are not usually thought of as introduced, although those that cross the sea are sometimes called "self-introduced." Some of these movements take place without any cause for concern. No-one speaks badly about crested pigeons and butterflies thriving in new locations. Everyone likes the white terns, birds which colonised Lord Howe Island after finding that its pine trees offer good nesting sites for their chicks. But many arrivals do acquire a bad name. Eradication campaigns are organised in Western Australia whenever Queensland fruit flies turn up, as they did in 1989 and 2016, probably via smuggled fruit; they are also a problem in other states. Redbacks in eastern Australia aren't welcome, nor are the mud snails in the Swan River.</p>
</div>



               <div id="passage-text-2" class="reading-passage">
  <h2 class="text-center">The Growing Industry of Background Music</h2>
  
  <p><strong>A</strong> Music can be surprisingly powerful, even when it is played in the background and is barely noticeable. Over recent decades, creating background music has become a booming industry. Researchers have found that music played in commercial settings can have an impact on how much time we think has passed while waiting in a queue, how engaged customers are with sales staff, and even how sweet or bitter food tastes.</p>
  
  <p><strong>B</strong> Rob Wood is the founder of Music Concierge in the UK, a company that chooses background music for businesses. Some clients hire Wood because they want to influence behaviour, others seek to create a certain atmosphere, culture, or ambience. The core of a music consultant's work is creating distinct, cohesive musical identities for brands. In 2018, Wood worked on music for a new hotel. His brief was to produce distinct playlists for separate areas: the lobby, the restaurant, and the gym. The hotel manager explained every detail: the build materials, the history, and a prediction of the average restaurant bill. Much of Wood's job involves taking abstract suggestions and turning them into music. A large amount of intuition is also required. It is a complex process and part of his job is comprehending what businesses really want, which can be very demanding. It is sometimes hard to know whether he should deliver something that will precisely match expectations or pleasantly surprise them.</p>
  
  <p><strong>C</strong> In the 1920s, George Owen Squier, a former US army officer, developed a new way to transmit audio through wires. His idea led to the creation of Wired Music (renamed Muzak), which enabled businesses to play music throughout offices and commercial premises. In its early days, Muzak sold itself on the basis that its music would enhance job performance. Its programme for offices and factories played classical recordings in 15-minute sequences, alternated with silence. Each time the music sequence resumed, it rose in intensity. Muzak set the template for background music that would persist for decades. In terms of distribution, Muzak used wires to convey its music; the company sent a bulky cartridge to its customers through the post and it was then played through a specially designed device. In the 1970s, the introduction of affordable multideck tape players suddenly made it easy for businesses to choose and play music continuously. The CD was the first digital format for music and, by the late 1990s, it had enabled background music companies to develop digital libraries where tracks could be organised according to preference. But that was just a taste of the new world of infinite choice that was to come.</p>
  
  <p><strong>D</strong> Despite technological advances, it's the influence that background music has on customer behaviour which is driving its growth. Psychologists believe that music influences consumers in two main ways. The first is physical; numerous studies have confirmed that we often subconsciously match what we are doing to what we hear. For instance, one study found that diners chewed faster when higher tempo music was played. The second approach focuses on the associations that music can trigger. Another study revealed that diners in a cafeteria were willing to part with more money when classical music was played in the background than when there was none at all. One explanation, researchers suggested, was that diners associated classical music with quality.</p>
  
  <p><strong>E</strong> However, it is the inoffensive nature of this kind of background music that creates some of the industry's fiercest critics. A UK group, Pipedown, founded by Nigel Rodgers, campaigns 'for freedom from unwanted music in public places'. The group claims that such music is impossible to escape and adds to the overall levels of noise pollution in public. 'You're not going for a special sort of atmosphere, you're just going to do your shopping,' Rodgers said. One of Pipedown's boldest claims is that there is 'no genuine evidence' that background music increases sales. Opinions vary on this question, although most professionals do not share Pipedown's position. Adrian North, a psychology professor at Curtin University in Perth, Australia, argues that small purchases are where it is most possible to influence consumers. He conducted a study that found that customers were more likely to choose either French or German wine, depending on which of the respective countries' music they heard, something he contrasted with a decision like buying a car where music would not have such an impact. Others argue that it makes more sense to think about the influence of background music in terms of subtle, long-term benefits, rather than immediate impact on sales. Rhonda Hadi, marketing professor at Oxford University, UK, believes companies that provide an experience, such as flights or accommodation, can reap the greatest rewards. She believes that people 'rely on any cues they can to gauge the quality of the service that they've received'.</p>
  
  <p><strong>F</strong> Companies have capitalised on the sweeping changes to the world of retail in recent years. Many businesses are no longer just functional places to buy things; they are presented as an experience. Since 2008, streaming music via the internet has become the way most people listen to music. For background music companies, streaming is both a threat and an opportunity. On the one hand, companies can select and tailor the music they deliver to businesses with greater speed, flexibility, and precision than ever before. On the other hand, access to vast music libraries has made everyone a music specialist. However, Richard Hampson at Imagesound believes a real-life curator is indispensable. He emphasises the intuitive side to his job. 'It's always been about feel and human touch,' he argues. 'Human taste is really important.'</p>
</div>




              <div id="passage-text-3" class="reading-passage">
  <h2 class="text-center">Conscious and Unconscious Thought</h2>

  <p>Great scientists and artists have long known about the unconscious mind. The founder of
  psychoanalysis, Sigmund Freud, argued that most of our real motivation lies below
  conscious awareness and that we require the services of a psychoanalyst to explain
  ourselves to ourselves. Even those celebrated scientists who believe that Freud
  exaggerated the importance of the unconscious argue that it is a part of our minds which
  we should learn to control and take advantage of.</p>

  <p>The great mathematician Alfred North Whitehead seemed to be a supporter of unconscious
  mental processing when he said: 'It is a profoundly erroneous truism, repeated by all
  copybooks and by eminent people making speeches, that we should cultivate the habit of
  thinking about what we are doing. The precise opposite is the case.' What Whitehead
  meant by this is that some of the greatest breakthroughs in creativity occur when a problem
  is consciously shelved for a while — 'don't think about it, just sleep on it' — after which the
  unconscious mind offers a solution. This is a process which psychoanalysts call incubation.</p>

  <p>Now the latest psychological research confirms that we can all incubate a problem to our
  own advantage. Ap Dijksterhuis, a psychologist at the University of Amsterdam, has
  recently published a series of experiments in which students were presented with
  complex everyday problems to solve. In one experiment they were given the opportunity
  to think carefully about a decision; in another experiment they were distracted by an
  irrelevant task whilst making a decision. The surprising result, published in the Journal
  of Personality and Social Psychology, was that 'unconscious' thinkers made the better
  decisions.</p>

  <p>Timothy Wilson and colleagues from the University of Virginia's psychology department
  conducted another experiment. Participants were presented with five posters and asked to
  choose one to take home. A little later, they were telephoned and asked how satisfied they
  were with their choice — a measure of whether they had made the right decision from a
  subjective point of view. Some participants had picked their poster straight away, whereas
  others were asked to analyse carefully the pros and cons of each poster. It turned out that
  people who had analysed were less satisfied with their choice than people who had not
  applied logic. Paradoxically, it seems that those who had consciously weighed up the
  various attributes had made relatively poor decisions.</p>

  <p>The conclusion that has to be drawn from current research suggests the somewhat
  counterintuitive idea that the more complex a problem is, the less likely it becomes that
  conscious thought can contribute much. If a dilemma is particularly difficult, a lot of
  information has to be taken into account and it appears that conscious thought is not good
  at this. The message is that when it comes to intricate problems with many variables, you
  should let the unconscious deal with it.</p>

  <p>Using dreaming is one way of doing this. Dreams are the part of sleep most strongly
  correlated with rapid eye movement (REM) and have been associated with enhanced
  creativity and novel solutions. The latest research suggests that, if you want to enhance
  unconscious problem-solving, you should try to think about your problems immediately
  after dreaming. In a recent experiment, psychiatrist Matthew Walker and colleagues from
  the Laboratory of Neurophysiology at Harvard Medical School woke up half of their
  experimental subjects immediately after REM sleep, and the other half just after sleep
  with no dreams, and then asked them to solve crossword puzzles. REM awakenings
  provided a 32 per cent advantage in the number of puzzles solved, compared with non-REM awakenings.</p>

  <p>But you don't have to be asleep to use the unconscious mind when you are not thinking
  of anything in particular, which is why daydreams are so useful in the quest for creativity.
  Daniel Goleman, the famous psychologist who proposed the theory of 'emotional
  intelligence', urges us to be more aware of, and discount, a key obstacle that the
  conscious mind imposes on the unconscious: that of self-censorship. This is the voice
  that whispers to you, 'they'll think I'm foolish' or 'that will never work', keeping you
  imprisoned within the boundaries of what is deemed acceptable. Howard Gardner, a
  professor of cognition and education at Harvard University, suggests that we free
  ourselves from the straitjacket of always doing things the same way. In seeking to go
  beyond the routine and conventional, you will gain confidence in trusting your
  unconscious, he says.</p>
</div>



</div>
            <div class="resizer" id="resizer"></div>
            <div class="questions-panel" id="questions-panel">
              <div id="questions-1" class="question-set hidden">
  <div class="questions-container">

    <!-- Questions 1–7: Complete the notes below -->
<div class="question" data-q-start="1" data-q-end="7">
  <div class="question-prompt">
    <p><strong>Questions 1–7</strong>: Complete the notes below.</p>
    <p>Choose <strong>ONE WORD ONLY</strong> from the passage for each answer.</p>
    <p>Write your answers in boxes <b>1–7</b> on your answer sheet.</p>
  </div>

  <div class="note-section">
    <h2 class="text-center">Natives speacis on the move</h2>
    <h4>Mud snails in Western Australia</h4>
    <ul>
      <li>Mud snails: an Australian native species originally from the 1 <input type="text" id="q1".></li>
      <li>Snails contribute to the problem of seaweed replacing healthy vegetation.</li>
      <li>Seaweed comes out of the 2 <input type="text" id="q2">.</li>
      <li>Snail waste acts as a 3 <input type="text" id="q3"> and this makes the seaweed problem worse.</li>
    </ul>

    <h4>Examples of unintentional movement of species</h4>
    <ul>
      <li>Queensland frogs are transported south along with bananas.</li>
      <li>Spiders are often carried in materials for 4 <input type="text" id="q4">.</li>
      <li>Construction are carried when transporting livestock to the coast.</li>
    </ul>

    <h4>Examples of species moving when the landscape changes</h4>
    <ul>
      <li>When 5 <input type="text" id="q5"> are built, waterbirds move to the area.</li>
      <li>Planting citrus trees attracted 6 <input type="text" id="q6"> to country areas.</li>
    </ul>

    <h4>Examples of deliberate movement of species</h4>
    <ul>
      <li>In order to kill snakes, kookaburras were moved to different areas.</li>
      <li>Platypuses were taken from the 7 <input type="text" id="q7"> when their numbers dropped there</li>
    </ul>
  </div>
</div>

<!-- Questions 8–13: True / False / Not Given -->
<div class="question" data-q-start="8" data-q-end="13">
  <div class="question-prompt">
    <p><strong>Questions 8–13</strong><br>
    Do the following statements agree with the information given in the passage?<br>
    In boxes <b>8–13</b> on your answer sheet, write:</p>
    <ul>
      <li><b>TRUE</b> if the statement agrees with the information</li>
      <li><b>FALSE</b> if the statement contradicts the information</li>
      <li><b>NOT GIVEN</b> if there is no information on this</li>
    </ul>
  </div>

  <div class="tf-question">
    <div class="tf-question-line"><span class="tf-question-number">8</span> Mud snails were introduced to Western Australia by scientists.</div>
    <div class="tf-options">
      <label><input type="radio" name="q8" value="TRUE"> TRUE</label>
      <label><input type="radio" name="q8" value="FALSE"> FALSE</label>
      <label><input type="radio" name="q8" value="NOT GIVEN"> NOT GIVEN</label>
    </div>
  </div>

  <div class="tf-question">
    <div class="tf-question-line"><span class="tf-question-number">9</span> Queensland frogs often travel together with bananas.</div>
    <div class="tf-options">
      <label><input type="radio" name="q9" value="TRUE"> TRUE</label>
      <label><input type="radio" name="q9" value="FALSE"> FALSE</label>
      <label><input type="radio" name="q9" value="NOT GIVEN"> NOT GIVEN</label>
    </div>
  </div>

  <div class="tf-question">
    <div class="tf-question-line"><span class="tf-question-number">10</span> Construction companies deliberately move livestock along the coast.</div>
    <div class="tf-options">
      <label><input type="radio" name="q10" value="TRUE"> TRUE</label>
      <label><input type="radio" name="q10" value="FALSE"> FALSE</label>
      <label><input type="radio" name="q10" value="NOT GIVEN"> NOT GIVEN</label>
    </div>
  </div>

  <div class="tf-question">
    <div class="tf-question-line"><span class="tf-question-number">11</span> Waterbirds relocate naturally when wetlands are created by dams.</div>
    <div class="tf-options">
      <label><input type="radio" name="q11" value="TRUE"> TRUE</label>
      <label><input type="radio" name="q11" value="FALSE"> FALSE</label>
      <label><input type="radio" name="q11" value="NOT GIVEN"> NOT GIVEN</label>
    </div>
  </div>

  <div class="tf-question">
    <div class="tf-question-line"><span class="tf-question-number">12</span> Kookaburras were moved to new areas to reduce the population of snakes.</div>
    <div class="tf-options">
      <label><input type="radio" name="q12" value="TRUE"> TRUE</label>
      <label><input type="radio" name="q12" value="FALSE"> FALSE</label>
      <label><input type="radio" name="q12" value="NOT GIVEN"> NOT GIVEN</label>
    </div>
  </div>

  <div class="tf-question">
    <div class="tf-question-line"><span class="tf-question-number">13</span> Platypus populations declined because they were removed from rivers.</div>
    <div class="tf-options">
      <label><input type="radio" name="q13" value="TRUE"> TRUE</label>
      <label><input type="radio" name="q13" value="FALSE"> FALSE</label>
      <label><input type="radio" name="q13" value="NOT GIVEN"> NOT GIVEN</label>
    </div>
  </div>
</div>


  </div>
</div>


               <div id="questions-2" class="question-set hidden">
  <div class="questions-container">

    <!-- Questions 14–18: Which Paragraph Contains This Information -->
    <div class="question" data-q-start="14" data-q-end="18">
      <div class="question-prompt">
        <p><strong>Questions 14–18</strong></p>
        <p>Reading Passage 2 has six paragraphs, A–F.</p>
        <p>Which paragraph contains the following information?</p>
        <p>Write the correct letter, <strong>A–F</strong>, in boxes 14–18 on your answer sheet.</p>
        <p><em>NB You may use any letter more than once.</em></p>
      </div>

      <p>14. Details of how modern developments have created positive and negative consequences for the industry.
        <input type="text" id="q14" maxlength="1" class="answer-box">
      </p>
      <p>15. An account of opposition to the use of background music.
        <input type="text" id="q15" maxlength="1" class="answer-box">
      </p>
      <p>16. A comparison of customer spending patterns with and without background music.
        <input type="text" id="q16" maxlength="1" class="answer-box">
      </p>
      <p>17. A mention of how background music can make shoppers more responsive to shop assistants.
        <input type="text" id="q17" maxlength="1" class="answer-box">
      </p>
      <p>18. Details of a project which required different music in various parts of a building.
        <input type="text" id="q18" maxlength="1" class="answer-box">
      </p>
    </div>

    <!-- Questions 19–23: Matching Experts -->
    <div class="question" data-q-start="19" data-q-end="23">
      <div class="question-prompt">
        <p><strong>List of Experts</strong></p>
        <p>
          A Rob Wood<br>
          B Nigel Rodgers<br>
          C Adrian North<br>
          D Rhonda Hadi<br>
          E Richard Hampson
        </p>
        <p><strong>Questions 19–23</strong></p>
        <p>Match each statement with the correct expert, A–E.</p>
        <p>Write the correct letter, <strong>A–E</strong>, in boxes 19–23 on your answer sheet.</p>
      </div>

      <p>19. It is difficult to understand a client's specific wish.
        <input type="text" id="q19" maxlength="1" class="answer-box">
      </p>
      <p>20. Background music is especially beneficial to the tourism industry.
        <input type="text" id="q20" maxlength="1" class="answer-box">
      </p>
      <p>21. Background music has more effect on people who are spending less.
        <input type="text" id="q21" maxlength="1" class="answer-box">
      </p>
      <p>22. A creative music expert is crucial for businesses choosing background music.
        <input type="text" id="q22" maxlength="1" class="answer-box">
      </p>
      <p>23. Buying goods does not require a particular environment.
        <input type="text" id="q23" maxlength="1" class="answer-box">
      </p>
    </div>

    <!-- Questions 24–26: Summary Completion -->
    <div class="question" data-q-start="24" data-q-end="26">
      <div class="question-prompt">
        <p><strong>Questions 24–26</strong></p>
        <p>Complete the summary below.</p>
        <p>Choose <strong>ONE WORD ONLY</strong> from the passage for each answer.</p>
        <p>Write your answers in boxes 24–26 on your answer sheet.</p>
      </div>

      <div class="summary-text">
        <p class="text-center"><strong>The history of background music</strong></p>
        <p>In 1920, George Squier developed a way of transmitting music using a system of wires. His company claimed that 
          <input type="text" class="answer-input" id="q24" placeholder="24"> at work could be improved with the use of its audio programmes.
        </p>
        <p>However, in this audio format there was silence between each short musical section. Gradually, the 
          <input type="text" class="answer-input" id="q25" placeholder="25"> of the music increased. Muzak became the template for music in businesses for years to come.
        </p>
        <p>Different ways existed however; some companies delivered pre-recorded music in the form of a cartridge. Later, in the 1970s, tapes were used, but the real change came with the move to CDs. With these, background music specialists were able to arrange music selections into 
          <input type="text" class="answer-input" id="q26" placeholder="26">, on a computer.
        </p>
      </div>
    </div>

  </div>
</div>



               <div id="questions-3" class="question-set">
  <div class="questions-container">

    <!-- Questions 27–31: Matching People -->
<div class="question" data-q-start="27" data-q-end="31">
  <div class="question-prompt">
    <p><strong>Questions 27–31</strong></p>
    <p>Look at the following statements (Questions <b>27–31</b>) and the list of people below.</p>
    <p>Match each statement with the correct person, <strong>A–E</strong>.</p>
    <p><strong>Write the correct letter, A–F, in boxes 27–31 on your answer sheet.</strong></p>
  </div>

  <div class="people-list">
    <p><strong>List of People</strong></p>
    <p><b>A</b> – Alfred North Whitehead</p>
    <p><b>B</b> – Ap Dijksterhuis</p>
    <p><b>C</b> – Timothy Wilson</p>
    <p><b>D</b> – Matthew Walker</p>
    <p><b>E</b> – Daniel Goleman</p>
    <p><b>F</b> – Howard Gardner</p>
  </div>

  <div class="question-item">
    <span class="q-number">27.</span>
    <span class="q-text">People find it easier to solve problems at a particular point in the sleep cycle.</span>
    <input type="text" id="q27" class="answer-box" maxlength="1" placeholder="A–F">
  </div>

  <div class="question-item">
    <span class="q-number">28.</span>
    <span class="q-text">People should change their general behaviour patterns in order to benefit more from the unconscious.</span>
    <input type="text" id="q28" class="answer-box" maxlength="1" placeholder="A–F">
  </div>

  <div class="question-item">
    <span class="q-number">29.</span>
    <span class="q-text">When solving problems, people should try to ignore negative thoughts.</span>
    <input type="text" id="q29" class="answer-box" maxlength="1" placeholder="A–F">
  </div>

  <div class="question-item">
    <span class="q-number">30.</span>
    <span class="q-text">People can come up with ideas which are more innovative if they temporarily put a problem aside.</span>
    <input type="text" id="q30" class="answer-box" maxlength="1" placeholder="A–F">
  </div>

  <div class="question-item">
    <span class="q-number">31.</span>
    <span class="q-text">People who make quick decisions are less likely to regret them.</span>
    <input type="text" id="q31" class="answer-box" maxlength="1" placeholder="A–F">
  </div>
</div>

<hr>

<!-- Questions 32–34: Summary Completion -->
<div class="question" data-q-start="32" data-q-end="34">
  <div class="question-prompt">
    <p><strong>Questions 32–34</strong></p>
    <p>Complete the summary below.</p>
    <p>Choose <strong>NO MORE THAN TWO WORDS</strong> from the passage for each answer.</p>
    <p>Write your answers in boxes <strong>32–34</strong> on your answer sheet.</p>
  </div>

  <p class="text-center"><strong>The history of background music</strong></p>
  <p>Many scientists argue that people should make better use of their unconscious mind. Alfred North Whitehead, for example, gave support for the idea of 
    <b>32</b><input type="text" id="q32" data-answer="incubation">, 
    a term for people deliberately ignoring a problem over a period of time.</p>

  <p>Experiments in Amsterdam that required students to consider a tricky situation found them making good decisions while carrying out an unconnected 
    <b>33</b><input type="text" id="q33" data-answer="task">.</p>

  <p>Similarly, an experiment in Virginia which required subjects to make a selection from a number of different 
    <b>34</b><input type="text" id="q34" data-answer="posters"> 
    found people feeling happier with their decisions if they had made them quickly.</p>
</div>


<hr>

<!-- Questions 35–40: True / False / Not Given -->
<div class="question" data-q-start="35" data-q-end="40">
  <div class="question-prompt">
    <p><strong>Questions 35–40</strong></p>
    <p>Do the following statements agree with the information in the passage?</p>
    <p>In boxes <strong>35–40</strong> on your answer sheet, write:</p>
    <ul>
      <li><strong>TRUE</strong> if the statement agrees with the passage</li>
      <li><strong>FALSE</strong> if the statement contradicts the passage</li>
      <li><strong>NOT GIVEN</strong> if there is no information</li>
    </ul>
  </div>

  <!-- Question 35 -->
  <div class="tf-question">
    <p><span class="tf-question-number">35.</span> The experiment lasted more than 30 years.</p>
    <label><input type="radio" id="q35_true" name="q35" value="TRUE"> TRUE</label>
    <label><input type="radio" id="q35_false" name="q35" value="FALSE"> FALSE</label>
    <label><input type="radio" id="q35_ng" name="q35" value="NOT GIVEN"> NOT GIVEN</label>
  </div>

  <!-- Question 36 -->
  <div class="tf-question">
    <p><span class="tf-question-number">36.</span> The scientists repeated the same experiment twice.</p>
    <label><input type="radio" id="q36_true" name="q36" value="TRUE"> TRUE</label>
    <label><input type="radio" id="q36_false" name="q36" value="FALSE"> FALSE</label>
    <label><input type="radio" id="q36_ng" name="q36" value="NOT GIVEN"> NOT GIVEN</label>
  </div>

  <!-- Question 37 -->
  <div class="tf-question">
    <p><span class="tf-question-number">37.</span> The research team faced financial difficulties.</p>
    <label><input type="radio" id="q37_true" name="q37" value="TRUE"> TRUE</label>
    <label><input type="radio" id="q37_false" name="q37" value="FALSE"> FALSE</label>
    <label><input type="radio" id="q37_ng" name="q37" value="NOT GIVEN"> NOT GIVEN</label>
  </div>

  <!-- Question 38 -->
  <div class="tf-question">
    <p><span class="tf-question-number">38.</span> Only one person was responsible for the project.</p>
    <label><input type="radio" id="q38_true" name="q38" value="TRUE"> TRUE</label>
    <label><input type="radio" id="q38_false" name="q38" value="FALSE"> FALSE</label>
    <label><input type="radio" id="q38_ng" name="q38" value="NOT GIVEN"> NOT GIVEN</label>
  </div>

  <!-- Question 39 -->
  <div class="tf-question">
    <p><span class="tf-question-number">39.</span> The results of the experiment were unexpected.</p>
    <label><input type="radio" id="q39_true" name="q39" value="TRUE"> TRUE</label>
    <label><input type="radio" id="q39_false" name="q39" value="FALSE"> FALSE</label>
    <label><input type="radio" id="q39_ng" name="q39" value="NOT GIVEN"> NOT GIVEN</label>
  </div>

  <!-- Question 40 -->
  <div class="tf-question">
    <p><span class="tf-question-number">40.</span> Other scientists criticized the findings.</p>
    <label><input type="radio" id="q40_true" name="q40" value="TRUE"> TRUE</label>
    <label><input type="radio" id="q40_false" name="q40" value="FALSE"> FALSE</label>
    <label><input type="radio" id="q40_ng" name="q40" value="NOT GIVEN"> NOT GIVEN</label>
  </div>
</div>



  </div>
</div>


    <!-- Navigation Arrows -->
    <div class="nav-arrows">
        <button class="nav-arrow" onclick="previousQuestion()" id="prevBtn">‹</button>
        <button class="nav-arrow" onclick="nextQuestion()" id="nextBtn">›</button>
    </div>

    <!-- Bottom Navigation -->
    <nav class="nav-row perScorableItem" aria-label="Questions">
        <div class="footer__questionWrapper___1tZ46 multiple selected" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(1)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">1</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 13</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(1)"><span class="sr-only">Question 1</span><span aria-hidden="true">1</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(2)"><span class="sr-only">Question 2</span><span aria-hidden="true">2</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(3)"><span class="sr-only">Question 3</span><span aria-hidden="true">3</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(4)"><span class="sr-only">Question 4</span><span aria-hidden="true">4</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(5)"><span class="sr-only">Question 5</span><span aria-hidden="true">5</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(6)"><span class="sr-only">Question 6</span><span aria-hidden="true">6</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(7)"><span class="sr-only">Question 7</span><span aria-hidden="true">7</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(8)"><span class="sr-only">Question 8</span><span aria-hidden="true">8</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(9)"><span class="sr-only">Question 9</span><span aria-hidden="true">9</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(10)"><span class="sr-only">Question 10</span><span aria-hidden="true">10</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(11)"><span class="sr-only">Question 11</span><span aria-hidden="true">11</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(12)"><span class="sr-only">Question 12</span><span aria-hidden="true">12</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(13)"><span class="sr-only">Question 13</span><span aria-hidden="true">13</span></button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(2)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">2</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 13</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(14)"><span class="sr-only">Question 14</span><span aria-hidden="true">14</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(15)"><span class="sr-only">Question 15</span><span aria-hidden="true">15</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(16)"><span class="sr-only">Question 16</span><span aria-hidden="true">16</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(17)"><span class="sr-only">Question 17</span><span aria-hidden="true">17</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(18)"><span class="sr-only">Question 18</span><span aria-hidden="true">18</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(19)"><span class="sr-only">Question 19</span><span aria-hidden="true">19</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(20)"><span class="sr-only">Question 20</span><span aria-hidden="true">20</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(21)"><span class="sr-only">Question 21</span><span aria-hidden="true">21</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(22)"><span class="sr-only">Question 22</span><span aria-hidden="true">22</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(23)"><span class="sr-only">Question 23</span><span aria-hidden="true">23</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(24)"><span class="sr-only">Question 24</span><span aria-hidden="true">24</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(25)"><span class="sr-only">Question 25</span><span aria-hidden="true">25</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(26)"><span class="sr-only">Question 26</span><span aria-hidden="true">26</span></button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(3)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">3</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 14</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(27)"><span class="sr-only">Question 27</span><span aria-hidden="true">27</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(28)"><span class="sr-only">Question 28</span><span aria-hidden="true">28</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(29)"><span class="sr-only">Question 29</span><span aria-hidden="true">29</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(30)"><span class="sr-only">Question 30</span><span aria-hidden="true">30</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(31)"><span class="sr-only">Question 31</span><span aria-hidden="true">31</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(32)"><span class="sr-only">Question 32</span><span aria-hidden="true">32</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(33)"><span class="sr-only">Question 33</span><span aria-hidden="true">33</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(34)"><span class="sr-only">Question 34</span><span aria-hidden="true">34</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(35)"><span class="sr-only">Question 35</span><span aria-hidden="true">35</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(36)"><span class="sr-only">Question 36</span><span aria-hidden="true">36</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(37)"><span class="sr-only">Question 37</span><span aria-hidden="true">37</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(38)"><span class="sr-only">Question 38</span><span aria-hidden="true">38</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(39)"><span class="sr-only">Question 39</span><span aria-hidden="true">39</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(40)"><span class="sr-only">Question 40</span><span aria-hidden="true">40</span></button>
            </div>
        </div>
        
        <button id="deliver-button" aria-label="Review your answers" class="footer__deliverButton___3FM07">
            <i class="fa fa fa-check" aria-hidden="true"></i>
            <span>Check Answers</span>
        </button>
    </nav>

    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu">
        <div id="menu-highlight" class="context-menu-item" onclick="highlightText()">
            Highlight
        </div>
        <div id="menu-note" class="context-menu-item" onclick="addNote()">
            Note
        </div>
        <div id="menu-clear" class="context-menu-item" onclick="clearHighlight()">
            Clear
        </div>
        <div id="menu-clear-all" class="context-menu-item" onclick="clearAllHighlights()">
            Clear All
        </div>
    </div>

   <div id="results-modal" class="modal-overlay hidden">
    <div class="modal-content">
        <button class="modal-close-btn" onclick="closeResultsModal()">×</button>
        <div id="results-header"></div> <!-- This will show {Name} Your Results -->
        <div class="results-summary">
            <p>Score: <span id="results-score"></span> / 40</p>
            <p>IELTS Band: <span id="results-band"></span></p>
        </div>
        <div id="results-details" class="results-details-container"></div>
    </div>
</div>
<script>
// Allow dragging
document.querySelectorAll('.drag-item').forEach(item => {
  item.addEventListener('dragstart', function (event) {
    event.dataTransfer.setData("text/plain", this.dataset.value);
  });
});

// Allow dropping into zones
document.querySelectorAll('.drop-zone').forEach(zone => {
  zone.addEventListener('dragover', function (event) {
    event.preventDefault();
  });

  zone.addEventListener('drop', function (event) {
    event.preventDefault();
    const value = event.dataTransfer.getData("text/plain");
    const hiddenInput = this.querySelector('input[type="hidden"]');
    const span = this.querySelector('span');

    if (hiddenInput) {
      hiddenInput.value = value;   // ✅ Save answer
    }
    if (span) {
      span.textContent = value;    // Show chosen heading
      span.style.display = "inline";
    }
  });
});
</script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- STATE VARIABLES ---
        let currentPassage = 1;
        let currentQuestion = 1;
        let selectedRange = null;
        let timeInSeconds = 3600;
        let timerInterval;
        let draggedItem = null;
        let activeQuestionElement = null;
        let selectedDragItem = null;

        // --- DOM ELEMENTS ---
        const timerDisplay = document.querySelector('.timer-display');
        const timerToggleButton = document.getElementById('timer-toggle-btn');
        const timerResetButton = document.getElementById('timer-reset-btn');
        const deliverButton = document.getElementById('deliver-button');
        const resizer = document.getElementById('resizer');
        const passagePanel = document.getElementById('passage-panel');
        const questionsPanel = document.getElementById('questions-panel');
        const contextMenu = document.getElementById('contextMenu');

        // --- ICON SVGs ---
        const playIcon = '<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M8 5v14l11-7L8 5z"/></svg>';
        const pauseIcon = '<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';

        // --- ANSWERS ---
      const correctAnswers = {
  // Reading Passage 1: Questions 1–13
  '1': 'eastern',
  '2': 'shells',
  '3': 'fertilizer', // or 'fertiliser'
  '4': 'construction',
  '5': 'dams',
  '6': 'butterflies',
  '7': 'mainland',
  '8': 'FALSE',
  '9': 'FALSE',
  '10': 'TRUE',
  '11': 'NOT GIVEN',
  '12': 'TRUE',
  '13': 'NOT GIVEN',

  // Reading Passage 2: Questions 14–26
  '14': 'F',
  '15': 'E',
  '16': 'D',
  '17': 'A',
  '18': 'B',
  '19': 'A',
  '20': 'D',
  '21': 'C',
  '22': 'E',
  '23': 'B',
  '24': 'performance',
  '25': 'intensity',
  '26': 'libraries',

  // Reading Passage 3: Questions 27–40
  '27': 'D',
  '28': 'F',
  '29': 'E',
  '30': 'A',
  '31': 'C',
  '32': 'incubation',
  '33': 'task',
  '34': 'posters',
  '35': 'TRUE',
  '36': 'NOT GIVEN',
  '37': 'FALSE',
  '38': 'NOT GIVEN',
  '39': 'NOT GIVEN',
  '40': 'TRUE'
};




        // --- INITIALIZATION ---
        function initialize() {
            startTimer();
            initializeDragAndDrop();
            setupCheckboxLimits();
            setupExampleHeading();
            switchToPart(1); // Also calls goToQuestion(1) and updateNavigation
            
            document.body.addEventListener('input', updateAllIndicators);
            document.body.addEventListener('change', updateAllIndicators);
            deliverButton.addEventListener('click', checkAnswers);
            timerToggleButton.addEventListener('click', toggleTimer);
            timerResetButton.addEventListener('click', resetTimer);

            // Add click listeners to question containers for navigation
            document.querySelectorAll('[data-q-start]').forEach(el => {
                el.addEventListener('click', () => {
                    const qNum = parseInt(el.dataset.qStart, 10);
                    if (currentQuestion !== qNum) {
                        goToQuestion(qNum);
                    }
                });
            });

            resizer.addEventListener('mousedown', initResize, false);
            initializeContextMenu();
        }

        // --- CORE TEST LOGIC ---

        function checkAnswers() {
            // Disable all inputs to prevent changes
            const allInputs = document.querySelectorAll('input, select, textarea');
            allInputs.forEach(input => {
                input.disabled = true;
            });

            // Disable submit button
            deliverButton.disabled = true;
            deliverButton.style.cursor = 'not-allowed';
            
            clearInterval(timerInterval);
            let score = 0;
            const studentName = document.getElementById('studentName')?.value.trim() || "No Name Given";
            const totalQuestions = 40;
            const resultsDetailsContainer = document.getElementById('results-details');
            resultsDetailsContainer.innerHTML = '';

            document.querySelectorAll('.correct, .incorrect, .correct-answer-highlight').forEach(el => {
                el.classList.remove('correct', 'incorrect', 'correct-answer-highlight');
            });
            document.querySelectorAll('.correct-answer-display').forEach(el => el.remove());

            for (let i = 1; i <= totalQuestions; i++) {
                const questionKey = String(i);
                const correctAnswer = correctAnswers[questionKey];
                let userAnswer = '';
                let isCorrect = false;
                
                let userAnswerDisplay = 'Not Answered';
                const correctAnswerText = Array.isArray(correctAnswer) ? correctAnswer.join(' / ') : correctAnswer;

                const textInput = document.getElementById(`q${i}`);
                const radioGroup = document.querySelectorAll(`input[name="q${i}"][type="radio"]`);
                
                // Handle Text and Select Inputs
                if (textInput && (textInput.tagName === 'INPUT' || textInput.tagName === 'SELECT')) {
                    const element = textInput.closest('.matching-form-row') || textInput;
                    userAnswer = textInput.value.trim();
                    userAnswerDisplay = userAnswer || 'Not Answered';

                    if (textInput.tagName === 'SELECT') {
                        isCorrect = userAnswer === correctAnswer;
                    } else {
                        isCorrect = Array.isArray(correctAnswer) ?
                            correctAnswer.some(ans => userAnswer.toLowerCase() === ans.toLowerCase()) :
                            userAnswer.toLowerCase() === correctAnswer.toLowerCase();
                    }
                    
                    if (isCorrect) {
                        score++;
                        element.classList.add('correct');
                    } else {
                        element.classList.add('incorrect');
                        const correctAnswerSpan = document.createElement('span');
                        correctAnswerSpan.className = 'correct-answer-display';
                        correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswerText}</span>`;
                        textInput.parentNode.insertBefore(correctAnswerSpan, textInput.nextSibling);
                    }
                }
                // Handle Radio Button Inputs (T/F, MCQs)
                else if (radioGroup.length > 0) {
                    const questionContainer = radioGroup[0].closest('.tf-question') || radioGroup[0].closest('.multi-choice-question');
                    const checkedRadio = document.querySelector(`input[name="q${i}"]:checked`);

                    if (checkedRadio) {
                        userAnswer = checkedRadio.value;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;

                        const userLabel = checkedRadio.closest('.tf-option, .multi-choice-option');
                        if (userLabel) {
                            userLabel.classList.add(isCorrect ? 'correct' : 'incorrect');
                        }
                    }

                    if (isCorrect) {
                        score++;
                    } else {
                        if (questionContainer){
                            const correctOptionEl = questionContainer.querySelector(`input[value="${correctAnswerText}"]`);
                            if (correctOptionEl) {
                                const correctLabel = correctOptionEl.closest('.tf-option, .multi-choice-option');
                                if (correctLabel) {
                                    correctLabel.classList.add('correct-answer-highlight');
                                }
                            }
                        }
                    }
                }
                // Handle Checkbox Groups (e.g., questions 21-22)
                else if (i === 21 || i === 22) {
                    // For questions 21-22, check if the user selected the correct combination
                    const checkedBoxes = document.querySelectorAll('input[name="q21-22"]:checked');
                    const userAnswers = Array.from(checkedBoxes).map(cb => cb.value).sort();
                    const correctAnswers21_22 = ['B', 'D']; // The correct answers for questions 21-22
                    
                    if (i === 21) {
                        // Only check once for the pair
                        userAnswerDisplay = userAnswers.length > 0 ? userAnswers.join(', ') : 'Not Answered';
                        isCorrect = userAnswers.length === 2 && 
                                   userAnswers.every(ans => correctAnswers21_22.includes(ans)) &&
                                   correctAnswers21_22.every(ans => userAnswers.includes(ans));
                        
                        if (isCorrect) {
                            score += 2; // Both questions are correct
                            // Mark both questions as correct in nav
                            const nav21 = document.querySelector(`.subQuestion[onclick="goToQuestion(21)"]`);
                            const nav22 = document.querySelector(`.subQuestion[onclick="goToQuestion(22)"]`);
                            if (nav21) nav21.classList.add('correct');
                            if (nav22) nav22.classList.add('correct');
                        } else {
                            // Mark both as incorrect in nav
                            const nav21 = document.querySelector(`.subQuestion[onclick="goToQuestion(21)"]`);
                            const nav22 = document.querySelector(`.subQuestion[onclick="goToQuestion(22)"]`);
                            if (nav21) nav21.classList.add('incorrect');
                            if (nav22) nav22.classList.add('incorrect');
                        }
                        
                        // Visual feedback on checkboxes
                        checkedBoxes.forEach(cb => {
                            const option = cb.closest('.multi-choice-option');
                            if (correctAnswers21_22.includes(cb.value)) {
                                option.classList.add('correct');
                            } else {
                                option.classList.add('incorrect');
                            }
                        });
                        
                        // Show correct answers if user got it wrong
                        if (!isCorrect) {
                            correctAnswers21_22.forEach(correctVal => {
                                const correctCheckbox = document.querySelector(`input[name="q21-22"][value="${correctVal}"]`);
                                if (correctCheckbox && !correctCheckbox.checked) {
                                    correctCheckbox.closest('.multi-choice-option').classList.add('correct-answer-highlight');
                                }
                            });
                        }
                    } else if (i === 22) {
                        // Skip individual processing for question 22 since it's handled with 21
                        userAnswerDisplay = 'See Q21';
                        const nav21 = document.querySelector(`.subQuestion[onclick="goToQuestion(21)"]`);
                        isCorrect = nav21 && nav21.classList.contains('correct');
                        continue; // Skip the rest of processing for Q22
                    }
                }
                 
                // For showing results in the modal
                 const resultRow = `
                    <div class="result-row ${isCorrect ? '' : 'incorrect'}">
                        <span class="q-num">${i}</span>
                        <span class="user-ans">${userAnswerDisplay}</span>
                        <span class="correct-ans">${correctAnswerText}</span>
                    </div>`;
                resultsDetailsContainer.innerHTML += resultRow;
                
                // Update nav button color
                const navButton = document.querySelector(`.subQuestion[onclick="goToQuestion(${i})"]`);
                if (navButton) {
                    navButton.classList.remove('answered', 'active');
                    navButton.classList.add(isCorrect ? 'correct' : 'incorrect');
                }
            }

 const bandScore = calculateBandScore(score);
document.getElementById('results-header').innerHTML = `<strong>${studentName}</strong> — Your Results<br>
You scored ${score} out of 40 (Band ${bandScore}).`;

document.getElementById('results-modal').classList.remove('hidden');

        }

        function calculateBandScore(score) {
            if (score >= 39) return '9.0';
            const mapping = {
                40: 9.0, 39: 9.0, 38: 8.5, 37: 8.5, 36: 8.0, 35: 8.0, 34: 7.5,
                33: 7.5, 32: 7.0, 31: 7.0, 30: 7.0, 29: 6.5, 28: 6.5, 27: 6.5,
                26: 6.0, 25: 6.0, 24: 6.0, 23: 5.5, 22: 5.5, 21: 5.5, 20: 5.5,
                19: 5.0, 18: 5.0, 17: 5.0, 16: 5.0, 15: 5.0, 14: 4.5, 13: 4.5,
                12: 4.0, 11: 4.0, 10: 4.0, 9: 3.5, 8: 3.5, 7: 3.0, 6: 3.0,
                5: 2.5, 4: 2.5
            };
            if (score <= 0) return 0.0;
            if (score === 1) return 1.0;
            if (score <= 3) return 2.0;
            if (score <= 5) return 2.5;
            return mapping[score] || 0.0;
        }

        function getUserAnswer(qNum) {
            const textInput = document.getElementById(`q${qNum}`);
            const radioInput = document.querySelector(`input[name="q${qNum}"]:checked`);
            const dropZone = document.querySelector(`.drop-zone[data-q-start="${qNum}"]`);

            if (textInput) { // Handles <input type="text"> and <select>
                return { value: textInput.value, text: textInput.value || 'N/A' };
            }
            if (radioInput) {
                return { value: radioInput.value, text: radioInput.value };
            }
            if (dropZone) {
                const droppedItem = dropZone.querySelector('.drag-item');
                return { 
                    value: droppedItem ? droppedItem.dataset.value : null, 
                    text: droppedItem ? droppedItem.textContent.trim() : 'N/A' 
                };
            }
            return { value: null, text: 'N/A' };
        }

        function displayCorrectAnswer(qNum, correctAnswer) {
            // Handle multi-choice group questions (e.g., 38-40)
            if (qNum >= 38 && qNum <= 40) {
                 const correctAnswersArr = Array.isArray(correctAnswer) ? correctAnswer : [correctAnswer];
                 correctAnswersArr.forEach(ansValue => {
                    const correctInput = document.querySelector(`input[name="q38-40"][value="${ansValue}"]`);
                    correctInput?.closest('.multi-choice-option')?.classList.add('correct-answer-highlight');
                 });
                 return;
            }

            // Handle radio button questions by highlighting the correct label
            const correctRadioInput = document.querySelector(`input[name="q${qNum}"][value="${correctAnswer}"]`);
            if (correctRadioInput) {
                const parentOption = correctRadioInput.closest('.tf-option, .multi-choice-option');
                if (parentOption) {
                    parentOption.classList.add('correct-answer-highlight');
                    return;
                }
            }

            // Handle text inputs, select dropdowns, and others by showing the answer next to them
            const inputEl = document.getElementById(`q${qNum}`);
            if (inputEl) {
                const displaySpan = document.createElement('span');
                displaySpan.className = 'correct-answer-display';
                displaySpan.textContent = ` ✓ ${correctAnswer}`;
                inputEl.insertAdjacentElement('afterend', displaySpan);
                return; // Done
            }
            
            // Fallback for questions identified by a container (e.g., some T/F/NG questions)
            const element = findQuestionElement(qNum);
            if (element) {
                const displaySpan = document.createElement('span');
                displaySpan.className = 'correct-answer-display';
                displaySpan.textContent = ` ✓ ${correctAnswer}`;
                const itemContainer = element.querySelector('.tf-question-text');
                if (itemContainer) {
                     itemContainer.appendChild(displaySpan);
                } else {
                     element.appendChild(displaySpan);
                }
            }
        }
        
        function findQuestionElement(qNum) {
             return document.querySelector(`[data-q-start="${qNum}"]`);
        }

        function addResultToModal(qNum, userAnswer, correctAnswer, isCorrect) {
            const resultsDetails = document.getElementById('results-details');
            const row = document.createElement('div');
            row.className = 'result-row';
            if (!isCorrect) {
                row.classList.add('incorrect');
            }
            row.innerHTML = `
                <span class="q-num">${qNum}</span>
                <span class="user-ans">${userAnswer}</span>
                <span class="correct-ans">${correctAnswer}</span>
            `;
            resultsDetails.appendChild(row);
        }

        function showResultsModal() {
            document.getElementById('results-modal').classList.remove('hidden');
        }

        window.closeResultsModal = function() {
            document.getElementById('results-modal').classList.add('hidden');
        }
        
        function disableInputs() {
            deliverButton.innerHTML = `<span>Checked! View Results.</span>`;
            deliverButton.removeEventListener('click', checkAnswers);
            deliverButton.onclick = showResultsModal;

            document.querySelectorAll('input, select').forEach(el => {
                el.disabled = true;
                 if (el.matches('input[type=radio], input[type=checkbox]')) {
                     el.style.cursor = 'not-allowed';
                     el.parentElement.style.cursor = 'not-allowed';
                 }
            });
            document.querySelectorAll('.drag-item').forEach(el => {
                el.setAttribute('draggable', 'false');
                el.style.cursor = 'default';
            });
            document.querySelectorAll('.drop-zone').forEach(el => {
                el.classList.add('disabled');
            });
        }

        function checkValue(userValue, correctValue) {
            if (userValue === null || userValue === undefined) return false;
            const formattedUserValue = userValue.trim().toLowerCase();
            if (Array.isArray(correctValue)) {
                return correctValue.map(v => v.toLowerCase()).includes(formattedUserValue);
            } else {
                return formattedUserValue === String(correctValue).toLowerCase();
            }
        }

        function markQuestion(qNum, isCorrect) {
            const subQuestionBtn = document.querySelector(`.subQuestion[onclick="goToQuestion(${qNum})"]`);
            subQuestionBtn?.classList.add(isCorrect ? 'correct' : 'incorrect');

            const elementsToMark = [
                document.querySelector(`.tf-question[data-q-start="${qNum}"]`),
                document.querySelector(`.multi-choice-question[data-q-start="${qNum}"]`),
                document.querySelector(`.matching-question-item[data-q-start="${qNum}"]`),
                document.querySelector(`.drop-zone[data-q-start="${qNum}"]`),
                document.getElementById(`q${qNum}`),
                document.querySelector(`input[name="q${qNum}"]:checked`)?.closest('.tf-option'),
                document.querySelector(`input[name="q${qNum}"]:checked`)?.closest('.multi-choice-option')
            ];
            
            elementsToMark.forEach(el => {
                if (el) el.classList.add(isCorrect ? 'correct' : 'incorrect');
            });

             if (qNum === 14 || qNum === 15) {
                const multiChoiceContainer = document.querySelector('.multi-choice-question[data-q-start="14"]');
                if (multiChoiceContainer) multiChoiceContainer.classList.add(isCorrect ? 'correct' : 'incorrect');
             } else if (qNum >= 1 && qNum <= 5) {
                const pMatchInput = document.getElementById(`q${qNum}`);
                if (pMatchInput) pMatchInput.classList.add(isCorrect ? 'correct' : 'incorrect');
             } else if (qNum >= 38 && qNum <= 40) {
                // For this group, individual options are marked, not the container.
             }
        }

        function switchToPart(partNumber, goToQ = null) {
            currentPassage = partNumber;

            // Hide all passages and questions
            document.querySelectorAll('.reading-passage, .question-set, .part-header').forEach(el => {
                el.classList.add('hidden');
            });

            // Show the correct passage, questions, and header
            document.getElementById(`passage-text-${partNumber}`).classList.remove('hidden');
            document.getElementById(`questions-${partNumber}`).classList.remove('hidden');
            document.getElementById(`part-header-${partNumber}`).classList.remove('hidden');

            // Update bottom navigation 'selected' state
            document.querySelectorAll('.footer__questionWrapper___1tZ46').forEach((wrapper, index) => {
                wrapper.classList.toggle('selected', (index + 1) === partNumber);
            });

            // Go to the specified question or the first question of the part
            const firstQuestionOfPart = {1: 1, 2: 14, 3: 27}[partNumber];
            goToQuestion(goToQ !== null ? goToQ : firstQuestionOfPart);
        }
        
        function goToQuestion(questionNumber) {
            // Prevent unnecessary recursion: if already at the right passage and question, do nothing
            if (currentQuestion === questionNumber) {
                let passageNumber = 1;
                if (questionNumber >= 14 && questionNumber <= 26) passageNumber = 2;
                else if (questionNumber >= 27) passageNumber = 3;
                if (currentPassage === passageNumber) {
                    return;
                }
            }

            currentQuestion = questionNumber;

            let passageNumber = 1;
            if (questionNumber >= 14 && questionNumber <= 26) passageNumber = 2;
            else if (questionNumber >= 27) passageNumber = 3;

            if (currentPassage !== passageNumber) {
                switchToPart(passageNumber, questionNumber);
                return;
            }

            if (activeQuestionElement) {
                activeQuestionElement.classList.remove('active-question', 'active-input');
            }

            let targetEl = document.querySelector(`[data-q-start="${questionNumber}"]`);

            if (targetEl) {
                activeQuestionElement = targetEl;
                 if (targetEl.matches('input[type="text"]') || targetEl.matches('select')) {
                     targetEl.classList.add('active-input');
                 } else {
                     targetEl.classList.add('active-question');
                 }
                 scrollIntoViewIfNeeded(targetEl);
            } else {
                 const pMatch = document.querySelector(`.paragraph-matching-question select[id="q${questionNumber}"]`);
                 if(pMatch) {
                    activeQuestionElement = pMatch;
                    pMatch.classList.add('active-input');
                    scrollIntoViewIfNeeded(pMatch);
                 }
            }

            updateNavigation();
        }
        
        // --- UI & NAVIGATION ---

        function updateNavigation() {
            const navButtons = document.querySelectorAll('.subQuestion');
            navButtons.forEach(btn => btn.classList.remove('active'));
            const activeNav = document.querySelector(`.subQuestion[onclick="goToQuestion(${currentQuestion})"]`);
            if (activeNav) {
                activeNav.classList.add('active');
            }

            const inputs = document.querySelectorAll('.answer-input, .drop-zone.filled, .summary-drop-zone.filled');
            inputs.forEach(input => input.classList.remove('active-input'));
            
            const activeInput = document.getElementById(`q${currentQuestion}`);
            if (activeInput) {
                activeInput.classList.add('active-input');
                if (typeof activeInput.focus === 'function') {
                    activeInput.focus();
                }
            } else {
                const activeQuestionBlock = document.querySelector(`[data-q-start="${currentQuestion}"]`);
                if (activeQuestionBlock) {
                    const firstInput = activeQuestionBlock.querySelector('input, select');
                    if(firstInput) {
                        firstInput.classList.add('active-input');
                         if (typeof firstInput.focus === 'function') {
                            firstInput.focus();
                        }
                    }
                }
            }
        }
        
        function selectDragItem(item) {
            if (selectedDragItem) {
                selectedDragItem.classList.remove('selected');
            }
            selectedDragItem = item;
            if (selectedDragItem) {
                selectedDragItem.classList.add('selected');
            }
        }
        
        window.nextQuestion = () => currentQuestion < 40 && goToQuestion(currentQuestion + 1);
        window.previousQuestion = () => currentQuestion > 1 && goToQuestion(currentQuestion - 1);

        function updateAllIndicators() {
            updateAttemptedCount(1, 1, 13);
            updateAttemptedCount(2, 14, 26);
            updateAttemptedCount(3, 27, 40);
            updateAnsweredNav();
        }
        
        function updateAnsweredNav() {
            const navButtons = document.querySelectorAll('.subQuestion');
            navButtons.forEach(btn => {
                const qNum = parseInt(btn.textContent, 10);
                if (isQuestionAnswered(qNum)) {
                    btn.classList.add('answered');
                } else {
                    btn.classList.remove('answered');
                }
            });
        }
        
        function isQuestionAnswered(qNum) {
            // Special handling for questions 21-22 checkbox group
            if (qNum === 21 || qNum === 22) {
                const checkedBoxes = document.querySelectorAll('input[name="q21-22"]:checked');
                return checkedBoxes.length > 0;
            }
            
            const textInput = document.getElementById(`q${qNum}`);
            if (textInput && (textInput.value.trim() !== '' || (textInput.classList.contains('drop-zone') && textInput.children.length > 0))) {
                return true;
            }
            const radio = document.querySelector(`input[name="q${qNum}"]:checked`);
            if (radio) {
                return true;
            }
            const checkbox = document.querySelector(`input[name="q${qNum}"]:checked`);
            if (checkbox) {
                return true;
            }
            return false;
        }

        function scrollIntoViewIfNeeded(element) {
            const panel = element.closest('.questions-panel, .passage-panel');
            const panelRect = panel.getBoundingClientRect();
            const elementRect = element.getBoundingClientRect();
            if (elementRect.top < panelRect.top || elementRect.bottom > panelRect.bottom) {
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
        
        // --- DRAG AND DROP ---
        
        function initializeDragAndDrop() {
            document.querySelectorAll('.drag-item').forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                item.addEventListener('click', () => selectDragItem(item));
            });
            document.querySelectorAll('.drop-zone, .drag-options-container').forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            });
        }

        function handleDragStart(e) {
            draggedItem = e.target;
            setTimeout(() => e.target.classList.add('dragging'), 0);
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedItem = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            const targetZone = e.currentTarget;
            if (draggedItem && draggedItem.dataset.dndGroup === targetZone.dataset.dndGroup) {
                targetZone.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const targetZone = e.currentTarget;
            targetZone.classList.remove('drag-over');

            if (!draggedItem || draggedItem.dataset.dndGroup !== targetZone.dataset.dndGroup) {
                return;
            }

            const sourceZone = draggedItem.parentElement;
            if (sourceZone === targetZone) return; // Prevent dropping on itself

            const existingItemInTarget = targetZone.classList.contains('drop-zone') 
                ? targetZone.querySelector('.drag-item') 
                : null;

            // First, clear the target drop-zone of any text (like question numbers) before adding the new item.
            if (targetZone.classList.contains('drop-zone')) {
                Array.from(targetZone.childNodes).forEach(node => {
                    if (node.nodeType === Node.TEXT_NODE) {
                        node.remove();
                    }
                });
            }

            // Move the item that was in the target (if any) to the source zone.
            if (existingItemInTarget) {
                sourceZone.appendChild(existingItemInTarget);
            }
            
            // Finally, move the dragged item to the target zone.
            targetZone.appendChild(draggedItem);
            targetZone.classList.add('filled');

            // After the move, clean up the source zone if it's a drop-zone and is now empty.
            if (sourceZone.classList.contains('drop-zone') && !sourceZone.querySelector('.drag-item')) {
                 sourceZone.classList.remove('filled');
                 const qNum = sourceZone.dataset.qStart;
                 sourceZone.innerText = qNum; // Restore the question number
            }
            
            updateAllIndicators();
        }
        
        // --- MISC HELPERS ---
        
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval); // Ensure no multiple intervals
            timerInterval = setInterval(() => {
                timeInSeconds--;
                const minutes = Math.floor(timeInSeconds / 60);
                const seconds = timeInSeconds % 60;
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                if (timeInSeconds <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.textContent = "Time's up!";
                    // checkAnswers(); // Disabled to prevent modal from opening automatically.
                }
            }, 1000);
            timerToggleButton.innerHTML = pauseIcon;
        }

        function pauseTimer() {
            clearInterval(timerInterval);
            timerToggleButton.innerHTML = playIcon;
        }

        function toggleTimer() {
            // Check based on the icon currently displayed
            if (timerToggleButton.innerHTML.includes('M6 19h4V5H6v14z')) { // Check for pause icon shape
                pauseTimer();
            } else {
                startTimer();
            }
        }

        function resetTimer() {
            timeInSeconds = 3600;
            updateTimerDisplay();
            startTimer();
            timerToggleButton.innerHTML = pauseIcon;
        }
        
        function setupCheckboxLimits() {
            const checkboxGroups = [
                { name: 'q21-22', limit: 2 },
                { name: 'q38-40', limit: 3 }
            ];
            checkboxGroups.forEach(group => {
                const checkboxes = document.querySelectorAll(`input[name="${group.name}"]`);
                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        const checkedCount = document.querySelectorAll(`input[name="${group.name}"]:checked`).length;
                        if (checkedCount > group.limit) checkbox.checked = false;
                        updateAllIndicators();
                    });
                });
            });
        }

        function setupExampleHeading() {
            const exampleBox = document.querySelector('.example-box');
            if(exampleBox){
                const title = document.createElement('p');
                title.style.fontWeight = 'bold';
                title.textContent = 'List of Statements';
                // exampleBox.insertBefore(title, exampleBox.firstChild);
            }
        }
        
        function initResize(e) {
            e.preventDefault();
            const startX = e.clientX;
            const startWidth = passagePanel.offsetWidth;
            
            const doDrag = (e) => {
                const newWidth = startWidth + e.clientX - startX;
                if (newWidth > 200 && (document.body.clientWidth - newWidth - resizer.offsetWidth) > 200) {
                    passagePanel.style.flex = `0 0 ${newWidth}px`;
                }
            };
            const stopDrag = () => {
                window.removeEventListener('mousemove', doDrag, false);
                window.removeEventListener('mouseup', stopDrag, false);
            };
            
            window.addEventListener('mousemove', doDrag, false);
            window.addEventListener('mouseup', stopDrag, false);
        }
        
        // --- CONTEXT MENU (Highlighting) ---
        
        // --- HIGHLIGHT FEATURE ---
        function initializeContextMenu() {
            const panels = [passagePanel, questionsPanel];
            let highlightBtn = null;
            let removeHighlightBtn = null;
            let highlightTarget = null;

            // Helper to remove floating buttons
            function removeFloatingButtons() {
                if (highlightBtn && highlightBtn.parentNode) highlightBtn.parentNode.removeChild(highlightBtn);
                if (removeHighlightBtn && removeHighlightBtn.parentNode) removeHighlightBtn.parentNode.removeChild(removeHighlightBtn);
                highlightBtn = null;
                removeHighlightBtn = null;
                highlightTarget = null;
            }

            // Show highlight button near selection
            document.addEventListener('mouseup', (e) => {
                setTimeout(() => { // Wait for selection to update
                    const selection = window.getSelection();
                    if (selection && !selection.isCollapsed && selection.toString().trim().length > 0) {
                        const range = selection.getRangeAt(0);
                        if (panels.some(panel => panel.contains(range.commonAncestorContainer))) {
                            // Don't show highlight button if selection is within an existing highlight that has a remove button
                            const selectionParentHighlight = range.commonAncestorContainer.nodeType === Node.TEXT_NODE 
                                ? range.commonAncestorContainer.parentElement?.closest('.highlight')
                                : range.commonAncestorContainer.closest?.('.highlight');
                            
                            if (selectionParentHighlight && removeHighlightBtn && highlightTarget === selectionParentHighlight) {
                                // Selection is within the highlight that already has a remove button, don't interfere
                                return;
                            }
                            
                            removeFloatingButtons();
                            highlightBtn = document.createElement('button');
                            highlightBtn.textContent = 'Highlight';
                            highlightBtn.style.position = 'absolute';
                            highlightBtn.style.zIndex = 9999;
                            highlightBtn.style.background = '#ffe066';
                            highlightBtn.style.border = '1px solid #aaa';
                            highlightBtn.style.padding = '2px 10px';
                            highlightBtn.style.borderRadius = '4px';
                            highlightBtn.style.cursor = 'pointer';
                            // Position button near selection
                            const rect = range.getBoundingClientRect();
                            highlightBtn.style.left = `${window.scrollX + rect.left}px`;
                            highlightBtn.style.top = `${window.scrollY + rect.top - 30}px`;
                            document.body.appendChild(highlightBtn);
                            highlightBtn.onclick = function() {
                                const span = document.createElement('span');
                                span.className = 'highlight';
                                span.style.background = '#ffe066';
                                span.appendChild(range.extractContents());
                                range.insertNode(span);
                                removeFloatingButtons();
                                window.getSelection().removeAllRanges();
                            };
                        } else {
                            removeFloatingButtons();
                        }
                    } else {
                        removeFloatingButtons();
                    }
                }, 10);
            });

            // Use event delegation for highlight removal
            panels.forEach(panel => {
                panel.addEventListener('click', (e) => {
                    const highlightEl = e.target.closest('.highlight');
                    if (highlightEl) {
                        // Prevent double creation
                        if (removeHighlightBtn && highlightTarget === highlightEl) return;
                        removeFloatingButtons();
                        removeHighlightBtn = document.createElement('button');
                        removeHighlightBtn.textContent = 'Remove Highlight';
                        removeHighlightBtn.style.position = 'absolute';
                        removeHighlightBtn.style.zIndex = 9999;
                        removeHighlightBtn.style.background = '#ffb3b3';
                        removeHighlightBtn.style.border = '1px solid #aaa';
                        removeHighlightBtn.style.padding = '2px 10px';
                        removeHighlightBtn.style.borderRadius = '4px';
                        removeHighlightBtn.style.cursor = 'pointer';
                        const rect = highlightEl.getBoundingClientRect();
                        removeHighlightBtn.style.left = `${window.scrollX + rect.left}px`;
                        removeHighlightBtn.style.top = `${window.scrollY + rect.top - 30}px`;
                        document.body.appendChild(removeHighlightBtn);
                        highlightTarget = highlightEl;
                        removeHighlightBtn.addEventListener('click', function(ev) {
                            ev.stopPropagation();
                            // Unwrap highlight
                            const parent = highlightTarget.parentNode;
                            while (highlightTarget.firstChild) {
                                parent.insertBefore(highlightTarget.firstChild, highlightTarget);
                            }
                            parent.removeChild(highlightTarget);
                            parent.normalize();
                            removeFloatingButtons();
                        });
                    }
                });
            });

            // Remove floating buttons on scroll or click elsewhere
            document.addEventListener('scroll', removeFloatingButtons, true);
            document.addEventListener('mousedown', (e) => {
                // Delay removal so highlight click handler can run first
                setTimeout(() => {
                    if ((removeHighlightBtn && removeHighlightBtn.contains(e.target)) || (highlightBtn && highlightBtn.contains(e.target))) {
                        return;
                    }
                    if (e.target.closest('.highlight')) return;
                    removeFloatingButtons();
                }, 0);
            });
        }

        function closeContextMenu() {
            contextMenu.style.display = 'none';
            selectedRange = null; // Clear range after menu closes
        }

        function unwrapElement(element) {
            const parent = element.parentNode;
            if (!parent) return;
            while (element.firstChild) {
                parent.insertBefore(element.firstChild, element);
            }
            parent.removeChild(element);
            parent.normalize();
        }

        window.highlightText = () => {
            if (selectedRange && !selectedRange.collapsed) {
                const span = document.createElement('span');
                span.className = 'highlight';
                span.appendChild(selectedRange.extractContents());
                selectedRange.insertNode(span);
            }
            closeContextMenu();
            window.getSelection().removeAllRanges();
        };

        window.addNote = () => {
            const note = prompt('Enter your note:');
            if (note && selectedRange && !selectedRange.collapsed) {
                const span = document.createElement('span');
                span.className = 'comment-highlight';
                const tooltip = document.createElement('span');
                tooltip.className = 'comment-tooltip';
                tooltip.textContent = note;
                span.appendChild(selectedRange.extractContents());
                span.appendChild(tooltip);
                selectedRange.insertNode(span);
            }
            closeContextMenu();
            window.getSelection().removeAllRanges();
        };

        window.clearHighlight = () => {
             const elementToClear = contextMenu.targetElementForClear;
             if (elementToClear) {
                 unwrapElement(elementToClear);
             }
             closeContextMenu();
             window.getSelection().removeAllRanges();
        };
        
        window.clearAllHighlights = () => {
            document.querySelectorAll('.highlight, .comment-highlight').forEach(unwrapElement);
            closeContextMenu();
            window.getSelection().removeAllRanges();
        };

        function updateAttemptedCount(part, startQ, endQ) {
            let answeredCount = 0;
            for (let i = startQ; i <= endQ; i++) {
                if (isQuestionAnswered(i)) {
                    answeredCount++;
                }
            }
            const partHeader = document.querySelector(`.footer__questionNo___3WNct[onclick="switchToPart(${part})"]`);
            if (partHeader) {
                const countSpan = partHeader.querySelector('.attemptedCount');
                if (countSpan) {
                     countSpan.textContent = `${answeredCount} of ${endQ - startQ + 1}`;
                }
            }
        }

        // --- GLOBAL FUNCTION EXPOSURE ---
        window.nextQuestion = nextQuestion;
        window.previousQuestion = previousQuestion;
        window.goToQuestion = goToQuestion;
        window.switchToPart = switchToPart;
        window.closeResultsModal = closeResultsModal;
        window.highlightText = highlightText;
        window.addNote = addNote;
        window.clearHighlight = clearHighlight;
        window.clearAllHighlights = clearAllHighlights;

        // --- START THE APP ---
        initialize();
    });
    </script>

</body></html>